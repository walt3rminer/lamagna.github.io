<html>
<head>
<title>Category linux</title>
<link rel="stylesheet" type="text/css" href="css/blogstyle.css">
</head>
<body style="margin:20;padding:0;">
<script language="javascript">
window.parent.document.title = "Category linux";
</script>
<div id="section">
<p id="postTitle"><a href="Hackeando%20el%20DHCP%20en%20la%20red.html" id="alink">Hackeando el DHCP en la red</a></p>

Para bien o para mal, en casa tengo un proveedor de televisión por cable.  Es el servicio
tradicional donde llega un cable coaxial y se conecta al televisor.  Hace unos pocos dias
vinieron e instalaron un Decodificador, es un dispositivo que se conecta entre el cable
coaxial y la tele permitiendo ver señales digitales con mejor calidad, también incluye un
software con Youtube y aplicaciones para mirar televisión por Internet.<br /><br />

<b>El problema</b>: Este decodificador se conecta a la red LAN de la casa, pero no permite
configurarle una dirección IP estática, la única manera es que obtenga una IP, dirección
de máscara de red y servidores 
de resolución de nombres por <a href="https://www.ietf.org/rfc/rfc2131.txt">DHCP</a>.
<br /><br />

El verdadero problema es que me tomo muy en serio todo lo que permito y no permito
en mi red hogareña, cada servicio nuevo es algo que me preocupa.  Quería evitar tener
que instalar un servidor de DHCP, claramente está deshabilitado el DHCP en mi servidor
wifi por que hago funcionar a las máquinas con IP estática (hasta ahora).<br /><br />

<u>¿ Cómo evitar instalar un servidor de DHCP y hacer funcionar el decodificador que necesita
una IP ?  No hacerlo funcionar no es una opción.</u>
<br />
<b>Solucion:</b> Crear un servidor DHCP minimalista de menos de 200 lineas, 
un script en lo posible, bien simple de levantar y cerrar y poder controlar que IP asigno
a cada estación.<br /><br />


En el RFC se describe el funcionamiento de este protocolo, un gráfico muy claro es este, nos
va a servir luego para revisar el funcionamiento del programa.<br />

<pre>


                Server          Client          Server
            (not selected)                    (selected)

                  v               v               v
                  |               |               |
                  |     Begins initialization     |
                  |               |               |
                  | _____________/|\____________  |
                  |/DHCPDISCOVER | DHCPDISCOVER  \|
                  |               |               |
              Determines          |          Determines
             configuration        |         configuration
                  |               |               |
                  |\             |  ____________/ |
                  | \________    | /DHCPOFFER     |
                  | DHCPOFFER\   |/               |
                  |           \  |                |
                  |       Collects replies        |
                  |             \|                |
                  |     Selects configuration     |
                  |               |               |
                  | _____________/|\____________  |
                  |/ DHCPREQUEST  |  DHCPREQUEST\ |
                  |               |               |
                  |               |     Commits configuration
                  |               |               |
                  |               | _____________/|
                  |               |/ DHCPACK      |
                  |               |               |
                  |    Initialization complete    |
                  |               |               |
                  .               .               .
                  .               .               .
                  |               |               |
                  |      Graceful shutdown        |
                  |               |               |
                  |               |\ ____________ |
                  |               | DHCPRELEASE  \|
                  |               |               |
                  |               |        Discards lease
                  |               |               |
                  v               v               v
     Figure 3: Timeline diagram of messages exchanged between DHCP
               client and servers when allocating a new network address

</pre>

<br />

Para los más curiosos, recomiendo estos recursos para leer
acerca de DHCP:<br />

<a href="http://www.tcpipguide.com/free/t_SummaryOfDHCPOptionsBOOTPVendorInformationFields.htm" target=_new>recurso1</a><br />
<a href="http://www.tcpipguide.com/free/t_DHCPMessageFormat.htm" target=_new>recurso2</a><br />
<a href="http://www.petenetlive.com/KB/Article/0001168" target=_new>recurso3</a><br />
<br />
Esta es una imagen que armé mientras estudiaba el funcionamiento
de este viejo protocolo:<br />
<center>
<img src="images/dhcp1.png" width=600 height=400 />
</center>
<br />



Script server:<br />
<pre>
#!/usr/bin/perl
use strict;

use IO::Socket;
use Net::DHCP::Packet;
use Net::DHCP::Constants;

######## La ip del server:
my $server_ip = "10.10.10.176";
my $gateway = "10.10.10.1";
my $dnserver = "8.8.8.8";
my $subnet_mask = "255.255.255.255";

my %mac_a_ip = ();

# Decodificador
$mac_a_ip{"b0b88f232fc900000000000000000000"} = "10.10.10.4";
# VM 
$mac_a_ip{"080997ddbbf100000000000000000000"} = "10.10.10.5";

my $socket_in = IO::Socket::INET->new(
	LocalPort => 67,
	LocalAddr => "255.255.255.255",
	Proto    => 'udp') or die $@;

while(1) {
	my $buf;
	print "Waiting...";
	$socket_in->recv($buf,4096);
	my $packet = new Net::DHCP::Packet($buf);
	my $messagetype = $packet->getOptionValue(DHO_DHCP_MESSAGE_TYPE());
	print "Received:\n";
	print $packet->toString();

	if ($messagetype eq DHCPDISCOVER()) {
		send_offer($packet);
	} elsif ($messagetype eq DHCPREQUEST()) {
		$packet->comment(1);
		send_ack($packet);
	}
}

sub send_offer {
	my($request)=@_;
	print "-------- Envio mi oferta ---------\n";
	my $which_machine = $request->chaddr;
	my $client_ip = $mac_a_ip{"$which_machine"};
	print "A $which_machine Ofrezco IP: $client_ip [Servidor: $server_ip:67]\n";
	my $socket_out = IO::Socket::INET->new(
		PeerPort => 68,
		PeerAddr => "255.255.255.255",
		LocalAddr => "$server_ip:67",
		Broadcast => 1,
		Proto    => 'udp') or die $@;

	my $offer = new Net::DHCP::Packet(
                                     Op => BOOTREPLY(),
                                     Xid => $request->xid(),
                                     Flags => $request->flags(),
                                     Ciaddr => $request->ciaddr(),
                                     Yiaddr => $client_ip,
                                     Siaddr => $server_ip,
                                     Giaddr => $request->giaddr(),
                                     Chaddr => $request->chaddr(),
                                     DHO_DHCP_MESSAGE_TYPE() => DHCPOFFER(),
                                   );
	$offer->addOptionValue(DHO_DHCP_LEASE_TIME, 84600);
	$offer->addOptionValue(DHO_DOMAIN_NAME_SERVERS, $dnserver);
	$offer->addOptionValue(DHO_ROUTERS, $gateway);
	$offer->addOptionValue(DHO_SUBNET_MASK(), $subnet_mask);
	$offer->addOptionValue(DHO_NAME_SERVERS, $server_ip);
	$offer->addOptionValue(DHO_DHCP_LEASE_TIME, 100);
	print $offer->toString();
	$socket_out->send($offer->serialize()) or die $!;
}

sub send_ack {
	my ($request) = @_;
	print "-------- Envio ACK ---------\n";
	my $which_machine = $request->chaddr;
	my $client_ip = $mac_a_ip{"$which_machine"};
	print "A $which_machine ACK de IP: $client_ip [Servidor: $server_ip:67]\n";
	my $socket_out = IO::Socket::INET->new(
		PeerPort => 68,
		PeerAddr => "255.255.255.255",
		LocalAddr => "$server_ip:67",
		Broadcast => 1,
		Proto    => 'udp') or die $@;

	$request = Net::DHCP::Packet->new(
            Comment                 => $request->comment(),
            Op                      => BOOTREPLY(),
            Hops                    => $request->hops(),
            Xid                     => $request->xid(),
            Flags                   => $request->flags(),
            Ciaddr                  => $request->ciaddr(),
            Yiaddr                  => $client_ip,
            Siaddr                  => $request->siaddr(),
            Giaddr                  => $request->giaddr(),
            Chaddr                  => $request->chaddr(),
            DHO_DHCP_MESSAGE_TYPE() => DHCPACK(),
        );

	$request->addOptionValue(DHO_DHCP_LEASE_TIME, 84600);
	$request->addOptionValue(DHO_DOMAIN_NAME_SERVERS, $dnserver);
	$request->addOptionValue(DHO_SUBNET_MASK(), $subnet_mask);
	$request->addOptionValue(DHO_ROUTERS, $gateway);
	$socket_out->send($request->serialize()) or die $!;
	print STDERR "send ack\n";
}

</pre>
<br /><br />
Ahora revisando el funcionamiento del programa:
<br /><br />
Ejecutamos el servidorcito dhcpd.pl<br />

<pre>
Waiting...Received:
op = BOOTREQUEST
htype = HTYPE_ETHER
hlen = 6
hops = 0
xid = 829e755
secs = 2816
flags = 0
ciaddr = 10.10.10.55
yiaddr = 0.0.0.0
siaddr = 0.0.0.0
giaddr = 0.0.0.0
chaddr = 080027ddbbf1
sname = 
file = 
Options : 
 DHO_DHCP_MESSAGE_TYPE(53) = DHCPRELEASE
 DHO_DHCP_SERVER_IDENTIFIER(54) = 255.255.255.255
 DHO_DHCP_CLIENT_IDENTIFIER(61) = \x01\x08\x00'\xDD\xBB\xF1
padding [41] = 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
Waiting...Received:
op = BOOTREQUEST
htype = HTYPE_ETHER
hlen = 6
hops = 0
xid = f32fb34e
secs = 0
flags = 8000
ciaddr = 0.0.0.0
yiaddr = 0.0.0.0
siaddr = 0.0.0.0
giaddr = 0.0.0.0
chaddr = 080027ddbbf1
sname = 
file = 
Options : 
 DHO_DHCP_MESSAGE_TYPE(53) = DHCPDISCOVER
 DHO_DHCP_CLIENT_IDENTIFIER(61) = \x01\x08\x00'\xDD\xBB\xF1
 DHO_DHCP_REQUESTED_ADDRESS(50) = 10.10.10.55
 DHO_HOST_NAME(12) = IBM620-0
 DHO_VENDOR_CLASS_IDENTIFIER(60) = MSFT 5.0
 DHO_DHCP_PARAMETER_REQUEST_LIST(55) = 1 15 3 6 44 46 47 31 33 121 249 43
padding [7] = 00000000000000
</pre>

<br />
Aca le envio la IP ofrecida, por la MAC en el script se programa una IP.
<br />

<pre>
-------- Envio mi oferta ---------
A 080027ddbbf100000000000000000000 Ofrezco IP: 10.10.10.55 [Servidor: 10.10.10.176:67]
op = BOOTREPLY
htype = HTYPE_ETHER
hlen = 6
hops = 0
xid = f32fb34e
secs = 0
flags = 8000
ciaddr = 0.0.0.0
yiaddr = 10.10.10.55
siaddr = 10.10.10.176
giaddr = 0.0.0.0
chaddr = 080027ddbbf1
sname = 
file = 
Options : 
 DHO_DHCP_MESSAGE_TYPE(53) = DHCPOFFER
 DHO_DHCP_LEASE_TIME(51) = 100
 DHO_DOMAIN_NAME_SERVERS(6) = 8.8.8.8
 DHO_ROUTERS(3) = 10.10.10.1
 DHO_SUBNET_MASK(1) = 255.255.255.255
 DHO_NAME_SERVERS(5) = 10.10.10.176
 DHO_DHCP_LEASE_TIME(51) = 100
padding [0] = 
Waiting...Received:
op = BOOTREQUEST
htype = HTYPE_ETHER
hlen = 6
hops = 0
xid = f32fb34e
secs = 0
flags = 8000
ciaddr = 0.0.0.0
yiaddr = 0.0.0.0
siaddr = 0.0.0.0
giaddr = 0.0.0.0
chaddr = 080027ddbbf1
sname = 
file = 
Options : 
 DHO_DHCP_MESSAGE_TYPE(53) = DHCPREQUEST
 DHO_DHCP_CLIENT_IDENTIFIER(61) = \x01\x08\x00'\xDD\xBB\xF1
 DHO_DHCP_REQUESTED_ADDRESS(50) = 10.10.10.55
 DHO_HOST_NAME(12) = IBM620-0
 DHO_FQDN(81) = \x00\x00\x00IBM620-0
 DHO_VENDOR_CLASS_IDENTIFIER(60) = MSFT 5.0
 DHO_DHCP_PARAMETER_REQUEST_LIST(55) = 1 15 3 6 44 46 47 31 33 121 249 43
padding [0] = 
</pre>

<br />
Aca se le envia un "ACK" para finalizar la transacción.
<br />
<br />
<pre>
-------- Envio ACK ---------
A 080027ddbbf100000000000000000000 ACK de IP: 10.10.10.55 [Servidor: 10.10.10.176:67]
send ack
Waiting...Received:
op = BOOTREQUEST
htype = HTYPE_ETHER
hlen = 6
hops = 0
xid = 1973a052
secs = 0
flags = 8000
ciaddr = 10.10.10.55
yiaddr = 0.0.0.0
siaddr = 0.0.0.0
giaddr = 0.0.0.0
chaddr = 080027ddbbf1
sname = 
file = 
Options : 
 DHO_DHCP_MESSAGE_TYPE(53) = DHCPINFORM
 DHO_DHCP_CLIENT_IDENTIFIER(61) = \x01\x08\x00'\xDD\xBB\xF1
 DHO_HOST_NAME(12) = IBM620-0
 DHO_VENDOR_CLASS_IDENTIFIER(60) = MSFT 5.0
 DHO_DHCP_PARAMETER_REQUEST_LIST(55) = 1 15 3 6 44 46 47 31 33 121 249 43 252
padding [12] = 000000000000000000000000
Waiting...Received:
op = BOOTREQUEST
htype = HTYPE_ETHER
hlen = 6
hops = 0
xid = 1973a052
secs = 768
flags = 8000
ciaddr = 10.10.10.55
yiaddr = 0.0.0.0
siaddr = 0.0.0.0
giaddr = 0.0.0.0
chaddr = 080027ddbbf1
sname = 
file = 
Options : 
 DHO_DHCP_MESSAGE_TYPE(53) = DHCPINFORM
 DHO_DHCP_CLIENT_IDENTIFIER(61) = \x01\x08\x00'\xDD\xBB\xF1
 DHO_HOST_NAME(12) = IBM620-0
 DHO_VENDOR_CLASS_IDENTIFIER(60) = MSFT 5.0
 DHO_DHCP_PARAMETER_REQUEST_LIST(55) = 1 15 3 6 44 46 47 31 33 121 249 43 252
padding [12] = 000000000000000000000000
</pre>
<br />

<a href="https://github.com/walt3rminer/perl/tree/master/dhcpserver" target="_new">Fuente de este post</a><br />


<b>Published: Thursday, December 29, 2016</b>
<a href="tag_security">security</a>&nbsp;<a href="tag_linux">linux</a>&nbsp;<a href="tag_perl">perl</a>&nbsp;
</div>

<hr>
<div id="section">
<p id="postTitle"><a href="Tirando%20el%20blog%20por%20la%20ventana.html" id="alink">Tirando el blog por la ventana</a></p>

<b>Recalculando</b><br />
Llegó ese momento en el que uno hace click.  Años escribiendo en inglés y porqué ?
Es hora de revisar premisas y sofismas.
<br /><br />
Este año incluyo un ícono para donaciones, también acepto hardware en lo posible
que funcione como notebooks ó dispositivos de almacenamiento.<br /><br />
<b>Bienvenidos.</b>
<br />


<b>Published: Tuesday, December 27, 2016</b>
<a href="tag_security">security</a>&nbsp;<a href="tag_datamining">datamining</a>&nbsp;<a href="tag_apache">apache</a>&nbsp;<a href="tag_linux">linux</a>&nbsp;<a href="tag_privacy">privacy</a>&nbsp;
</div>

<hr>
<div id="section">
<p id="postTitle"><a href="Some%20linux%20firewall%20tips.html" id="alink">Some linux firewall tips</a></p>

The overconnected world needs some extra knowledge about protecting yourself from anti-democracy financed cyber-bandits,
so here some small but powerfull firewall setup tips:<br />

<b><u>Firewall setup:</u></b>
<pre>
<span style="color: #888888">iptables -F </span>
<span style="color: #888888">iptables -P INPUT DROP </span>
<span style="color: #888888">iptables -P OUTPUT DROP </span>
<span style="color: #888888">iptables -P FORWARD DROP </span>
<span style="color: #888888"># There is no return once you know these logging lines: </span>
<span style="color: #888888">iptables -A INPUT -p icmp -m limit -j LOG --log-prefix &quot;ICMP/IN: &quot; </span>
<span style="color: #888888">iptables -A OUTPUT -p icmp -m limit -j LOG --log-prefix &quot;ICMP/OUT: &quot; </span>
<span style="color: #888888">iptables -A INPUT -p tcp -m limit -j LOG --log-prefix &quot;TCP/IN: &quot; </span>
<span style="color: #888888">iptables -A OUTPUT -p tcp -m limit -j LOG --log-prefix &quot;TCP/OUT: &quot; </span>
<span style="color: #888888">iptables -A INPUT -p udp -m limit -j LOG --log-prefix &quot;UDP/OUT: &quot; </span>
<span style="color: #888888">iptables -A OUTPUT -p udp -m limit -j LOG --log-prefix &quot;UDP/OUT: &quot; </span>
</pre>
<br />
<b><u>Syslog setup, typically /etc/rsyslog.d/iptables.conf</u></b><br />
<pre>
:msg,contains,&quot;ICMP/IN:&quot; /var/log/iptables.log</span>
<span style="color: #888888">:msg,contains,&quot;ICMP/OUT:&quot; /var/log/iptables.log</span>
<span style="color: #888888">:msg,contains,&quot;TCP/IN:&quot; /var/log/iptables.log</span>
<span style="color: #888888">:msg,contains,&quot;TCP/OUT:&quot; /var/log/iptables.log</span>
<span style="color: #888888">:msg,contains,&quot;UDP/IN:&quot; /var/log/iptables.log</span>
<span style="color: #888888">:msg,contains,&quot;UDP/OUT:&quot; /var/log/iptables.log</span>
</pre>
<br />
<b><u>Restarting service</u></b><br />
/etc/init.d/rsyslog restart

<div style="clear: both;"></div>
<b>Published: Sunday, October 11, 2015</b>
<a href="tag_security">security</a>&nbsp;<a href="tag_linux">linux</a>&nbsp;
</div>

<hr>
<div id="section">
<p id="postTitle"><a href="Errors%20compiling%20VMware%20Server%20on%20Fedora%2012.html" id="alink">Errors compiling VMware Server on Fedora 12</a></p>
 Hi! Today i downloaded vmware server to use it on my Linux workstation. 
I am using Fedora 12 with the latest kernel update so i had not much hope to compile the vmware kernel modules without some troubleshooting.
<br />
After solving the problems, here i share the solutions i hope to help you. If you find it useful, remember that you can Invite me a kaffee ! :)
<br />
<ul>
<li> 1. Download the latest VMware workstation (It is free) <br />
https://www.vmware.com/tryvmware/p/activate.php?p=server20amp;lp=1amp;ext=1<br />
Note: I downloaded the rpm version.</li>
<li>2. Install it: yum install VMware-server-2.0.2-203138.i386.rpm</li>
<li>3. Try to compile the modules: vmware-config.pl
Ok.. in this moment a lot of warnings and errors appear between them, errors with vmnet, vmci, etc...</li>
</ul>
<pre>
make[1]: Leaving directory `/usr/src/kernels/2.6.32.10-90.fc12.i686#39;
Unable to build the vmnet module.<br />
Unable to build the vmci module.
</pre>
<ul>
<li>4. Patch the modules:<br />
Download from http://www.erdemap.com/store/2.6.32.10-90.fc12.vmmon.tar.gz<br />
wget http://www.erdemap.com/store/2.6.32.10-90.fc12.vmmon.tar.gz</li>
<li>5. unzip amp; untar it.</li>
<li>6. execute the patch shell script *inspect it first, it is very VERY basic*</li>
<li>7. After installing the patches, execute the vmware-config.pl</li>
</ul>
<pre>
Starting VMware services:
Virtual machine monitor [ OK ]
Virtual ethernet [ OK ]
Bridged networking on /dev/vmnet0 [ OK ]
Host-only networking on /dev/vmnet1 (background) [ OK ]
DHCP server on /dev/vmnet1 [ OK ]
Host-only networking on /dev/vmnet8 (background) [ OK ]
DHCP server on /dev/vmnet8 [ OK ]
NAT service on /dev/vmnet8 [ OK ]
VMware Server Authentication Daemon (background) [ OK ]
Shared Memory Available [ OK ]
Starting VMware management services:
VMware Server Host Agent (background) [ OK ]
VMware Virtual Infrastructure Web Access
Starting VMware autostart virtual machines:
</pre>
<b>Published: Saturday, April 03, 2010</b>
<a href="tag_admin">admin</a>&nbsp;<a href="tag_linux">linux</a>&nbsp;
</div>

<hr>
<div id="section">
<p id="postTitle"><a href="Upgrading%20Linux%20Daylight%20Saving%20Time%20%28timezone%29.html" id="alink">Upgrading Linux Daylight Saving Time (timezone)</a></p>

<div class="tightenable top">Linux uses a special mechanism called DST 
(Daylight Saving Time) that is used by linux to update the time of the 
operating system when the clock has to change for daylight saving. 
The daylight saving, of course, is different for every location and country.
<br /><br />
</div>
In 2005, the congress of United States changed its daylight saving, 
but at that time, Redhat 7.3 already existed and its daylight saving 
files where deprecated. Newer versions of Linux have their DST files 
updated but in United States, this year the time changes, and if there are RH 7.3, 
they will change the incorrect day.
<br />
<br /> Check if you have the new timezones:
<pre>
$ zdump -v /etc/localtime | grep 2007
</pre>
<br />
The file /etc/localtime is a link to the corresponding timezone 
for the country the computer is in, the files of timezones are in /usr/share/zoneinfo/
<br />
For example, California&#39;s file is in /usr/share/zoneinfo/US/Pacific
You could do:
<pre>
$ zdump -v /usr/share/zoneinfo/US/Pacific | grep 2007
If the output says:
/usr/share/zoneinfo/US/Pacific Sun Mar 11 09:59:59 2007 UTC = Sun Mar 11 01:59:59 2007 PST isdst=0 gmtoff=-28800
/usr/share/zoneinfo/US/Pacific Sun Mar 11 10:00:00 2007 UTC = Sun Mar 11 03:00:00 2007 PDT isdst=1 gmtoff=-25200
/usr/share/zoneinfo/US/Pacific Sun Nov 4 08:59:59 2007 UTC = Sun Nov 4 01:59:59 2007 PDT isdst=1 gmtoff=-25200
/usr/share/zoneinfo/US/Pacific Sun Nov 4 09:00:00 2007 UTC = Sun Nov 4 01:00:00 2007 PST isdst=0 gmtoff=-28800</span>
</pre>
<br /><br />
All is OK, if not, you have to upgrade Zoneinfo Files.
<br /></div><div class="tightenable">So it is required, in some &quot;old&quot; linux distributions, to upgrade the timezone files, steps are following:
<br /></div><div class="tightenable">1) Get the new timezone tzdata2007c.tar.gz copy it to some directory.
<br /></div><div class="tightenable"><span style="font-family: Arial,Helvetica; font-size: 100%;"><code>wget ftp://elsie.nci.nih.gov/pub/tzdata2007k.tar.gz
<br /></code></span>
<br /><span style="font-size: 85%;"><span style="font-family: courier new;">2) tar zvxf tzdata2007k.tar.gz</span>
<br /><span style="font-family: courier new;">3) zic -d zoneinfo northamerica</span>
<br /><span style="font-family: courier new;">4) cd zoneinfo</span>
<br /><span style="font-family: courier new;">5) cp -r * /usr/share/zoneinfo</span></span>
<br /></div><div class="tightenable">Now try again:
<br /></div><div class="tightenable" style="font-family: courier new;"><span style="font-size: 85%;">zdump -v /etc/localtime | grep 2007</span>
<br /></div><div class="tightenable bottom">
<br /></div>Sources:
<br /> http://www.linux-watch.com/news/NS6300294422.html <div style="clear: both;"></div>
<b>Published: Friday, March 09, 2007</b>
<a href="tag_linux">linux</a>&nbsp;<a href="tag_admin">admin</a>&nbsp;
</div>

<hr>
</body></html>
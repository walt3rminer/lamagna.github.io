<html>
<head>
<title>Secure php Server and programming practices</title>
<link rel="stylesheet" type="text/css" href="css/blogstyle.css">
</head>
<body>
<script language="javascript">
window.parent.document.title = "Secure php Server and programming practices";
</script>
<div id="section"><p id="postTitle">Secure php Server and programming practices</p>
<p><span style="font-size:85%;"><span style="font-family:arial;">In one of my works, the company wanted to have their webpage and they contracted a freelance programmer.<br />Keep up reading !</span><br /><br /><span style="font-family:arial;">He coded this in PHP:</span></span><br /><span style="font-size:85%;"><span style="font-family:courier new;">if(!$top)</span><br /><span style="font-family:courier new;"> $top=&quot;top_home.php&quot;;</span><br /><span style="font-family:courier new;"> include($top)</span></span><br /><br /><span style=";font-family:arial;font-size:85%;">This code works this way, you call the webpage with this url:<br />www.server.com/index.php?top=page.php</span><br /><br /><span style="font-size:85%;"><span style="font-family:arial;">For this to work we need in php.ini this variable in ON</span></span><br /><span style="font-size:85%;"><span style="font-family:courier new;">register_globals = On</span></span><br /><br /><span style="font-size:85%;"><span style="font-family:arial;">This is very insecure, so we asked him to do this change:</span></span><br /><br /><span style="font-size:85%;"><span style="font-family:courier new;">if(!$_GET[top])</span><br /><span style="font-family:courier new;"> $_GET[top]=&quot;top_home.php&quot;;</span><br /><span style="font-family:courier new;"> include($_GET[top])</span></span><br /><br /><span style="font-size:85%;"><span style="font-family:arial;">This is a little more secure, but it is a trap, you can still compromise the security of the server with a query like this:</span></span><br /><br /><span style="font-size:85%;"><span style="font-family:courier new;">www.server.com/index.php?top=/etc/passwd</span></span><br /><br /><span style="font-size:85%;"><span style="font-family:arial;">I recommend:</span><br /><br /><span style="font-family:arial;">1) To hardcode the filenames you want to open.<br /></span><span style="font-family:arial;">2) Use fopen() to open the filename, store it in a variable and then print it.<br />3) Do not use include()<br />4) Check the input variables with regular expressions ! Like this:<br /></span></span> <tt><br /></tt> <tt>if (ereg(&quot;^[a-z]+\.html$&quot;, $_GET[cen])) {<br /> echo &quot;Good!&quot;;<br />} else {<br /> die(&quot;Try hacking somebody else&#39;s site.&quot;);<br />}</tt><br /><span style="font-size:85%;"><br /><span style="font-family:arial;">5) Be preventive, save into logs or send you an email when somebody is trying strange things in your server, you will probably not be able to send the hacker to prison but detect the attack and take preventive measures if neccesary, with new politics.</span><br /><br /><span style="font-family:arial;">I hope it helped somebody, this is very common.<br /><br />What is required to be safe when you program a website and worry about Security is...<br /><br />In httpd.conf configure<br />php_admin_value open_basedir &quot;/home/webpagedirectory/&quot;<br /><br />In php.ini configure<br />allow_url_fopen = Off<br />enable_dl = Off<br />expose_php = Off<br />error_log = /var/log/error_php.log<br /><br />Security is a process.<br />If this was usefull please leave me a message with feedback !!! Thanks.<br /></span></span><div style="clear: both;"></div>
<b>Published: Saturday, November 12, 2005</b>
<hr>
</body></html>
<html>
<head>
<title>Secure php Server and programming practices</title>
<link rel="stylesheet" type="text/css" href="css/blogstyle.css">
</head>
<body style="margin:20;padding:0;">
<script language="javascript">
window.parent.document.title = "Secure php Server and programming practices";
</script>
<div id="section">
<p id="postTitle"><a href="Secure%20php%20Server%20and%20programming%20practices.html" id="alink">Secure php Server and programming practices</a></p>


In one of my works, the company wanted to have their 
webpage and they contracted a freelance programmer.<br />
<br />
He coded this in PHP:
<pre>
if(!$top)
$top=&quot;top_home.php&quot;;
include($top)
</pre>
<br />
Proof Of Concept - This code works this way, you call the webpage with this url:<br />
<pre>
www.server.com/index.php?top=page.php
</pre>
<br />
For this to work we need in php.ini this variable in ON
<pre>
register_globals = On
</pre>

This is very insecure, so we asked him to do this change:
<br />
<pre>
if(!$_GET[top])
$_GET[top]=&quot;top_home.php&quot;;
include($_GET[top])
</pre>
<br />
This is a little more secure, but it is a trap, you 
can still compromise the security of the server with a query like this:
<br />
<pre>
www.server.com/index.php?top=/etc/passwd
</pre>
<br />

<u>I recommend:</u>

1) To hardcode the filenames you want to open.<br />
2) Use fopen() to open the filename, store it in a variable and then print it.<br />
3) Do not use include()<br />
4) Check the input variables with regular expressions ! Like this:<br />

<pre>
if (ereg(&quot;^[a-z]+\.html$&quot;, $_GET[cen])) {
 echo &quot;Good!&quot;;<br />
} else {
 die(&quot;Try hacking somebody else&#39;s site.&quot;);
}
</pre>

<br />

5) Be preventive, save into logs or send you an email when somebody 
is trying strange things in your server, you will probably not be 
able to send the hacker to prison but detect the attack and take 
preventive measures if neccesary, with new politics.<br />

<br />
I hope it helped somebody, this is very common.<br />
<br />
What is required to be safe when you program a website and worry about Security is...<br />
<br />
In httpd.conf configure<br />
<pre>
php_admin_value open_basedir &quot;/home/webpagedirectory/&quot;
</pre>
In php.ini configure<br />
<pre>
allow_url_fopen = Off
enable_dl = Off
expose_php = Off
error_log = /var/log/error_php.log
</pre>
<u>Security is a process.</u><br />
If this was usefull please leave me a message with feedback !!! Thanks.<br />
<div style="clear: both;">

<b>Published: Saturday, November 12, 2005</b>
<a href="tag_security">security</a>&nbsp;
</div>

<hr>
</body></html>
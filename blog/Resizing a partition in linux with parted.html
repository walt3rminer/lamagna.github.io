<html>
<head>
<title>Resizing a partition in linux with parted</title>
<link rel="stylesheet" type="text/css" href="css/blogstyle.css">
</head>
<body style="margin:20;padding:0;">
<script language="javascript">
window.parent.document.title = "Resizing a partition in linux with parted";
</script>
<div id="section"><p id="postTitle">Resizing a partition in linux with parted</p>
<p> To resize an ext3 partition comes handy LVM, but i will explain how i did it without. I did this in a Fedora 6, booting with a Fedora 7 or Knoppix disk and entering into rescue mode, sorry but i can not take any resposibility if something goes wrong while following this procedures&gt;<br /><br />After getting the prompt in Fedora 7 or any other distro in rescue mode, unmount all the partitions of the filesystem you want to resize, in my case it is the disk /dev/sda, but it could be /dev/hda<br /><br />Fedora 7 rescue disk has parted installed and i get , so we are going to use it.<br /><span style="font-weight: bold;">#umount /dev/{sda1,sda2,sda3}</span><br /><span style="font-weight: bold;"></span>Check the Filesystem to resize, i am going to shrink sda2 first<br /><span style="font-weight: bold;">#e2fsck -f /dev/sda2</span><br /><span>Resizing the partition:</span><span style="font-weight: bold;"><br />#resize2fs -p /dev/sda2 2600M<br /></span>The <i>size</i> parameter may be suffixed by one of the following the units designators: &#39;s&#39;, &#39;K&#39;, &#39;M&#39;, or &#39;G&#39;, for 512 byte sectors, kilobytes, megabytes, or gigabytes, respectively. The -p argument is to display a nice status bar.<br />The message on screen is:<br /><span style="font-weight: bold;">Resizing the filesystem on /dev/sda2 to 665600 (4k) blocks</span><br />So i do the calculation of how many bytes this is to use it later in fdisk:<br />665600 blocks * 4k = 2662400 Bytes.<br />My partition had 4 G before, now, after resizing, the partition will still have 4G, but &quot;resize2fs&quot; has prepared for a technical surgical procedure ;-) we are going to delete the partition and recreate it<br /><br />I entered fdisk and deleted the /dev/sda2 partition, then i recreated it with the same starting cylinder and +2662400K as size (this is imperative and may loose all your information if you do not do this right, again, i take no responsability, the results may depend on filesystems). Then i wrote the partition with &quot;w&quot; and went back to the shell.<br /><br />Now i execute again:<br /><span style="font-weight: bold;">#resize2fs -p /dev/sda2 2600M<br /></span><span>And this command to recreate some information of the partition table.</span><span style="font-weight: bold;"><br /></span><span style="font-weight: bold;">#e2fsck -f /dev/sda2<br /></span>Time to reboot and see if all is ok, yes it is all fine and the partition has now 2662400 K.<br /><br />Now it is time to resize the next partition, /dev/sda3, to take the space left by /dev/sda2, another surgical procedure is required.<br /><br />Enter the rescue mode again, umount the partitions that are going to be resized and lets delete /dev/sda4 to begin at the end of /dev/sda2, this is done with &quot;fdisk&quot;.<br />From the resize2fs man page:<br /><span style="color: rgb(0, 153, 0);">If you wish to shrink an ext2 </span><span class="highlight2" style="color: rgb(0, 153, 0);">partition</span><span style="color: rgb(0, 153, 0);">, first use </span><b style="color: rgb(0, 153, 0);"><span class="highlight0">resize2fs</span></b><span style="color: rgb(0, 153, 0);"> to shrink the size of filesystem. Then you may use </span><i style="color: rgb(0, 153, 0);"><b>fdisk</b>(8)</i><span style="color: rgb(0, 153, 0);"> to shrink the size of the </span><span class="highlight2" style="color: rgb(0, 153, 0);">partition</span><span style="color: rgb(0, 153, 0);">. When shrinking the size of the </span><span class="highlight2" style="color: rgb(0, 153, 0);">partition</span><span style="color: rgb(0, 153, 0);">, make sure you do not make it smaller than the new size of the ext2 filesystem!<br /><br /></span>My partition distribution looks like this now:<br /><span style="font-family: courier new;"> start end</span><br /><span style="font-family: courier new;">/dev/sda1 1 13</span><br /><span style="font-family: courier new;">/dev/sda2 14 345</span><br /><span style="font-family: courier new;">/dev/sda3 1012 1043</span><br /><span style="font-family: courier new;">/dev/sda4 744 1011</span><br /><br /><span style="font-family: courier new;"> Start - End</span><br /><span style="font-family: courier new;">1 - 32,3 kb - 107 MB</span><br /><span style="font-family: courier new;">2 - 107 MB - 2838 MB</span><br /><span style="font-family: courier new;">4 - 6111 MB - 8316 MB</span><br /><span style="font-family: courier new;">3 - 8316 MB - 8579 MB</span><br /><br />The beginning of /dev/sda4 should be 346, so i used parted to move the partition. Be careful, it is not possible to delete the partition and recreate it with fdisk (well, it is possible but it would corrupt the partition because the partition table would be in the middle of the disk).<br /><br /><span style="font-weight: bold;">#parted</span><br /><span style="font-weight: bold;">(parted) move</span><br /><span style="font-weight: bold;">Start? 3000MB</span><br /><span style="font-weight: bold;">End? 5204MB</span><br />Something curious happened here, i had to specify &quot;MB&quot; at the end of the numbers, else it gave me an error about &quot;Can&#39;t have overlapping partitions&quot; <div style="clear: both;"></div>
<b>Published: Sunday, January 06, 2008</b>
<a href="tag_linux">linux</a>&nbsp;<a href="tag_debian">debian</a>&nbsp;
<hr>
</body></html>
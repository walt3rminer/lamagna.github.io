<html>
<head>
<title>A postgres tip</title>
<link rel="stylesheet" type="text/css" href="css/blogstyle.css">
</head>
<body style="margin:20;padding:0;">
<script language="javascript">
window.parent.document.title = "A postgres tip";
</script>
<div id="section">
<p id="postTitle"><a href="A%20postgres%20tip.html" id="alink">A postgres tip</a></p>
 I needed to do some calculation on a postgres function so i had to use plpgsql. I also had to return a set of records. To do this i instintivelly used a &#39;return setof record&#39; and defined a variable<br />&#39;ret_row record&#39; but i got this error:<br /><br />Query failed: ERROR: a column definition list is required for functions returning &quot;record&quot;<br /><br />The solution is to define the function like this:<br /><br /><span style="font-size:85%;"><span style="font-family:courier new;">CREATE OR REPLACE FUNCTION data_from_user(id_user bigint, </span><br /><span style="font-family:courier new;">lati double precision, longi double precision, z integer)</span><br /><span style="font-family:courier new;"> RETURNS SETOF markas AS</span><br /><span style="font-family:courier new;">$BODY$</span><br /><span style="font-family:courier new;">DECLARE</span><br /><span style="font-family:courier new;"> ret_row markas%rowtype;</span><br /><span style="font-family:courier new;"> diffa double precision := 0;</span><br /><span style="font-family:courier new;"> diffb double precision := 0;</span><br /><span style="font-family:courier new;"> sumar double precision := 0;</span><br /><span style="font-family:courier new;">BEGIN</span><br /><span style="font-family:courier new;">if z = 15 then</span><br /><span style="font-family:courier new;"> sumar := 0.03;</span><br /><span style="font-family:courier new;">end if;</span><br /><span style="font-family:courier new;">diffa := lati + sumar;</span><br /><span style="font-family:courier new;">diffb := longi + sumar;</span><br /><br /><span style="font-family:courier new;">for ret_row in</span><br /><span style="font-family:courier new;">select * from markas where id_owner = $1 and lat &lt;&gt;<br /><span style="font-family:courier new;">union</span><br /><span style="font-family:courier new;">select * from markas where id_owner in (</span><br /><span style="font-family:courier new;"> select id_solicitado from solicitudes where</span><br /><span style="font-family:courier new;"> id_solicitante = $1 and id_estado = 2)</span><br /><span style="font-family:courier new;"> and lat &lt;&gt;<br /><span style="font-family:courier new;">union</span><br /><span style="font-family:courier new;">select * from markas where id_owner in (</span><br /><span style="font-family:courier new;"> select id_solicitante from solicitudes where</span><br /><span style="font-family:courier new;"> id_solicitado = $1 and id_estado = 2)</span><br /><span style="font-family:courier new;"> and lat &lt;&gt;<br /><span style="font-family:courier new;"> loop</span><br /><span style="font-family:courier new;"> return next ret_row;</span><br /><span style="font-family:courier new;"> end loop;</span><br /><span style="font-family:courier new;">return;</span><br /><span style="font-family:courier new;">END;</span><br /><span style="font-family:courier new;">$BODY$</span><br /><span style="font-family:courier new;"> LANGUAGE &#39;plpgsql&#39; VOLATILE;</span></span><br /><br />I hope it was helpfull.<br /></span></span></span><div style="clear: both;"></div>
<b>Published: Tuesday, September 01, 2009</b>

</div>

<hr>
</body></html>